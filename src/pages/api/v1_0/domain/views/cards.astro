---
import DomainDisplayPanel from "@components/dashboard/DomainDisplayPanel.astro";
import { getEmployeeDomainsFromUUID, getIUIDFromUUID } from "database:functions";

if (Astro.request.method.toLowerCase() != "get") return new Response("Method Not Allowed", { status: 405 });

const uuid = Astro.url.searchParams.get("token")!.toString();
const institutionID = Astro.url.searchParams.get("iuid")!.toString();

const domainList = await getEmployeeDomainsFromUUID(institutionID, uuid);
---

{
    domainList.domains.map(domain => {
        return <DomainDisplayPanel name={domain.name} description={domain.description} domainId={domain.id} />;
    })
}
